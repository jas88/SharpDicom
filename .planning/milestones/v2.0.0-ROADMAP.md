# Milestone v2.0.0: Network, Codecs & De-identification

**Status:** ✅ SHIPPED 2026-01-30
**Phases:** 10-14
**Total Plans:** 38

## Overview

Full DICOM networking stack, pluggable image codecs, and standards-compliant de-identification.

## Phases

### Phase 10: Network Foundation

**Goal**: Establish DICOM networking infrastructure with PDU handling, association negotiation, and basic connectivity verification

**Depends on**: Phase 4 (character encoding), Phase 7 (dataset serialization)
**Plans**: 7 plans

Plans:
- [x] 10-01-PLAN.md — PDU types, constants, DicomStatus, network exceptions
- [x] 10-02-PLAN.md — Presentation context, user information, association options
- [x] 10-03-PLAN.md — PduReader/PduWriter ref structs for PDU I/O
- [x] 10-04-PLAN.md — DicomAssociation state machine (13 states)
- [x] 10-05-PLAN.md — DicomClient SCU with async connect/release
- [x] 10-06-PLAN.md — DicomServer SCP with event-based handlers
- [x] 10-07-PLAN.md — C-ECHO SCU/SCP and integration tests

**Delivered:**
- PDU parsing and building (A-ASSOCIATE-RQ/AC/RJ, P-DATA-TF, A-RELEASE-RQ/RP, A-ABORT)
- PduReader/PduWriter ref structs following DicomStreamReader pattern
- DicomAssociation state machine with presentation context negotiation
- DicomClient class with async API for SCU operations
- DicomServer class with event-based handlers for SCP operations
- C-ECHO SCU/SCP implementation

---

### Phase 11: DIMSE Services

**Goal**: Complete DIMSE-C services for image storage, query, and retrieval operations

**Depends on**: Phase 10 (association and PDU infrastructure)
**Plans**: 7 plans

Plans:
- [x] 11-01-PLAN.md — Common DIMSE types (QueryRetrieveLevel, progress structs, DicomCommand extensions)
- [x] 11-02-PLAN.md — CStoreScu service with streaming send and progress reporting
- [x] 11-03-PLAN.md — CFindScu service with IAsyncEnumerable and DicomQuery builder
- [x] 11-04-PLAN.md — C-STORE SCP handler support in DicomServer (buffered and streaming modes)
- [x] 11-05-PLAN.md — CMoveScu service for third-party retrieval
- [x] 11-06-PLAN.md — CGetScu service with inline C-STORE sub-operation handling
- [x] 11-07-PLAN.md — Integration tests (roundtrip and DCMTK interoperability)

**Delivered:**
- C-STORE SCU (send DICOM files to remote AE)
- C-STORE SCP with streaming support
- C-FIND SCU (query PACS/RIS)
- C-MOVE SCU (retrieve from PACS)
- C-GET SCU (retrieve via C-STORE sub-ops)
- IAsyncEnumerable for query/retrieve responses

---

### Phase 12: Pure C# Codecs

**Goal**: JPEG and JPEG 2000 codecs implemented in pure C# for maximum portability and AOT compatibility

**Depends on**: Phase 9 (IPixelDataCodec interface and CodecRegistry)
**Plans**: 7 plans

Plans:
- [x] 12-01-PLAN.md — Infrastructure (TransferSyntax additions, JpegMarkers, HuffmanTable, QuantizationTable, ColorConversion)
- [x] 12-02-PLAN.md — JPEG primitives (DctTransform, BitReader, BitWriter, JpegCodecOptions)
- [x] 12-03-PLAN.md — JPEG Baseline codec (decoder, encoder, codec class, tests)
- [x] 12-04-PLAN.md — JPEG Lossless codec (Predictor, LosslessHuffman, codec class, tests)
- [x] 12-05-PLAN.md — JPEG 2000 infrastructure (J2kCodestream, DWT transforms, MqCoder)
- [x] 12-06-PLAN.md — JPEG 2000 coding (EbcotEncoder/Decoder, PacketEncoder/Decoder, J2kEncoder/Decoder)
- [x] 12-07-PLAN.md — Integration (Jpeg2000LosslessCodec, Jpeg2000LossyCodec, CodecInitializer, integration tests)

**Delivered:**
- JPEG Baseline codec (8-bit lossy)
- JPEG Lossless codec (Process 14 SV1)
- JPEG 2000 Lossless/Lossy codecs
- Pure C# with AOT compatibility
- CodecInitializer for explicit registration

---

### Phase 13: Native Codecs Package

**Goal**: Optional high-performance codec package with native library wrappers for production workloads

**Depends on**: Phase 12 (establishes codec interface patterns)
**Plans**: 9 plans

Plans:
- [x] 13-01-PLAN.md — Zig build system, C API header, version/feature detection, CI workflow
- [x] 13-02-PLAN.md — libjpeg-turbo wrapper for JPEG baseline/extended (8-bit, 12-bit)
- [x] 13-03-PLAN.md — OpenJPEG wrapper for JPEG 2000 with resolution level and ROI decode
- [x] 13-04-PLAN.md — CharLS wrapper for JPEG-LS and FFmpeg wrapper for video codecs
- [x] 13-05-PLAN.md — GPU acceleration with nvJPEG2000 and CPU fallback
- [x] 13-06-PLAN.md — Managed P/Invoke layer, NativeCodecs static class, exception types
- [x] 13-07-PLAN.md — IPixelDataCodec implementations and CodecRegistry priority integration
- [x] 13-08-PLAN.md — NuGet package structure (meta + runtime packages for 6 RIDs)
- [x] 13-09-PLAN.md — Test suite for native codec initialization and decode/encode operations

**Delivered:**
- SharpDicom.Codecs NuGet package
- libjpeg-turbo wrapper (2-6x faster)
- OpenJPEG wrapper
- CharLS for JPEG-LS
- FFmpeg for video codecs
- nvJPEG2000 GPU acceleration
- Cross-platform binaries (win-x64, linux-x64, osx-arm64)
- ModuleInitializer auto-registration

---

### Phase 14: De-identification

**Goal**: Standards-compliant DICOM de-identification with PS3.15 Basic Profile and consistent UID/date handling

**Depends on**: Phase 4 (encoding), Phase 7 (file writing)
**Plans**: 8 plans

Plans:
- [x] 14-01-PLAN.md — Source generator for action tables from part15.xml
- [x] 14-02-PLAN.md — Core types, action resolution, dummy value generation
- [x] 14-03-PLAN.md — UID remapping with SQLite persistence
- [x] 14-04-PLAN.md — Date/time shifting with configurable strategies
- [x] 14-05-PLAN.md — DicomDeidentifier with fluent API and element callback
- [x] 14-06-PLAN.md — JSON config format with $extends inheritance and presets
- [x] 14-07-PLAN.md — Clean Pixel Data Option with region redaction
- [x] 14-08-PLAN.md — Batch processing and integration tests

**Delivered:**
- PS3.15 Basic Application Level Confidentiality Profile
- Source-generated action table from part15.xml (654 attribute definitions)
- UID remapping with SQLite persistence
- Date shifting with multiple strategies
- DicomDeidentifier with fluent builder API
- JSON configuration with $extends inheritance
- Pixel data redaction for burned-in annotations
- BatchDeidentifier for directory processing

---

## Milestone Summary

**Key Decisions:**
- PduReader/PduWriter as ref structs (zero-copy PDU parsing)
- 13-state association state machine matching PS3.8
- IAsyncEnumerable for query/retrieve streaming
- Pure C# codecs with explicit CodecInitializer.RegisterAll() for AOT
- Zig for cross-compilation (single toolchain, 6 targets)
- LibraryImport for .NET 7+, DllImport for netstandard2.0
- System.Text.Json for de-identification config (AOT-friendly)
- Modality risk categorization for burned-in annotation detection

**Issues Resolved:**
- State machine timing for A-ASSOCIATE-RQ handling
- SCP role selection for C-GET sub-operations
- NET6+ only tests excluded from polyfills project

**Issues Deferred:**
- Zero-copy PDU parsing via System.IO.Pipelines
- Element callback during network receive
- Transfer syntax negotiation with transcoding

**Technical Debt Incurred:**
- Some codecs (JPEG 2000) are reference-quality, not production-optimized

---

_For current project status, see .planning/ROADMAP.md_
