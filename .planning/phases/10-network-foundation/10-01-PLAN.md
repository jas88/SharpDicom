---
phase: 10-network-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/SharpDicom/Network/Pdu/PduType.cs
  - src/SharpDicom/Network/Pdu/PduConstants.cs
  - src/SharpDicom/Network/Pdu/ItemType.cs
  - src/SharpDicom/Network/Pdu/RejectResult.cs
  - src/SharpDicom/Network/Pdu/RejectSource.cs
  - src/SharpDicom/Network/Pdu/RejectReason.cs
  - src/SharpDicom/Network/Pdu/AbortSource.cs
  - src/SharpDicom/Network/Pdu/AbortReason.cs
  - src/SharpDicom/Network/DicomStatus.cs
  - src/SharpDicom/Network/StatusCategory.cs
  - src/SharpDicom/Network/Exceptions/DicomNetworkException.cs
  - src/SharpDicom/Network/Exceptions/DicomAssociationException.cs
  - src/SharpDicom/Network/Exceptions/DicomAbortException.cs
  - tests/SharpDicom.Tests/Network/DicomStatusTests.cs
autonomous: true

must_haves:
  truths:
    - "DicomStatus correctly categorizes DICOM status codes (success, pending, warning, failure, cancel)"
    - "All 7 PDU types have corresponding enum values"
    - "All PDU item types are defined for variable field parsing"
    - "Network exceptions extend DicomException hierarchy"
  artifacts:
    - path: "src/SharpDicom/Network/Pdu/PduType.cs"
      provides: "PDU type enum (0x01-0x07)"
      contains: "public enum PduType"
    - path: "src/SharpDicom/Network/DicomStatus.cs"
      provides: "DIMSE status struct with categorization"
      contains: "public readonly struct DicomStatus"
    - path: "src/SharpDicom/Network/Exceptions/DicomNetworkException.cs"
      provides: "Base network exception"
      contains: "public class DicomNetworkException"
  key_links:
    - from: "DicomStatus"
      to: "StatusCategory"
      via: "status code categorization"
      pattern: "StatusCategory CategorizeCode"
    - from: "DicomNetworkException"
      to: "DicomException"
      via: "inheritance"
      pattern: "class DicomNetworkException : DicomException"
---

<objective>
Establish PDU types, DIMSE status handling, and network exception hierarchy for DICOM networking foundation.

Purpose: Define the fundamental types and constants required by all other networking components. This includes PDU type identification, status code handling for DIMSE operations, and a proper exception hierarchy for network errors.

Output: Core enums, structs, and exception classes that form the foundation of the Network namespace.
</objective>

<execution_context>
@/Users/jas88/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jas88/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-network-foundation/10-RESEARCH.md

Reference existing patterns:
@src/SharpDicom/Data/Exceptions/DicomException.cs
@src/SharpDicom/Data/DicomVR.cs (for readonly struct pattern)
</context>

<tasks>

<task type="auto">
  <name>Task 1: PDU types and constants</name>
  <files>
    src/SharpDicom/Network/Pdu/PduType.cs
    src/SharpDicom/Network/Pdu/PduConstants.cs
    src/SharpDicom/Network/Pdu/ItemType.cs
  </files>
  <action>
Create the Network/Pdu directory structure with:

1. **PduType.cs** - Enum for the 7 PDU types per PS3.8 Section 9.3:
   - AssociateRequest = 0x01
   - AssociateAccept = 0x02
   - AssociateReject = 0x03
   - PDataTransfer = 0x04
   - ReleaseRequest = 0x05
   - ReleaseResponse = 0x06
   - Abort = 0x07

2. **PduConstants.cs** - Static class with:
   - PDU header length (6 bytes)
   - Fixed PDU lengths (AssociateRj = 10, ReleaseRq = 10, etc.)
   - Associate fixed fields length (68 bytes before variable items)
   - Default max PDU length (16384)
   - Protocol version (0x0001)
   - AE title length (16)

3. **ItemType.cs** - Enum for variable field item types:
   - ApplicationContext = 0x10
   - PresentationContextRequest = 0x20
   - PresentationContextAccept = 0x21
   - AbstractSyntax = 0x30
   - TransferSyntax = 0x40
   - UserInformation = 0x50
   - MaximumLength = 0x51
   - ImplementationClassUid = 0x52
   - ImplementationVersionName = 0x55

Include XML documentation for all public types.
  </action>
  <verify>
dotnet build src/SharpDicom/SharpDicom.csproj
  </verify>
  <done>
PDU types, constants, and item types compile without warnings. All 7 PDU types and all item types are defined.
  </done>
</task>

<task type="auto">
  <name>Task 2: Association rejection/abort enums</name>
  <files>
    src/SharpDicom/Network/Pdu/RejectResult.cs
    src/SharpDicom/Network/Pdu/RejectSource.cs
    src/SharpDicom/Network/Pdu/RejectReason.cs
    src/SharpDicom/Network/Pdu/AbortSource.cs
    src/SharpDicom/Network/Pdu/AbortReason.cs
  </files>
  <action>
Create enums for A-ASSOCIATE-RJ and A-ABORT PDU fields per PS3.8:

1. **RejectResult.cs** - A-ASSOCIATE-RJ Result field:
   - PermanentRejection = 1
   - TransientRejection = 2

2. **RejectSource.cs** - A-ASSOCIATE-RJ Source field:
   - ServiceUser = 1
   - ServiceProviderAcse = 2
   - ServiceProviderPresentation = 3

3. **RejectReason.cs** - A-ASSOCIATE-RJ Reason field (varies by source):
   - NoReasonGiven = 1
   - ApplicationContextNotSupported = 2
   - CallingAETitleNotRecognized = 3
   - CalledAETitleNotRecognized = 7
   (See PS3.8 Table 9-21 for full list)

4. **AbortSource.cs** - A-ABORT Source field:
   - ServiceUser = 0
   - ServiceProvider = 2

5. **AbortReason.cs** - A-ABORT Reason field (when Source is provider):
   - NotSpecified = 0
   - UnrecognizedPdu = 1
   - UnexpectedPdu = 2
   - UnrecognizedPduParameter = 4
   - UnexpectedPduParameter = 5
   - InvalidPduParameter = 6

Include XML documentation with DICOM PS3.8 section references.
  </action>
  <verify>
dotnet build src/SharpDicom/SharpDicom.csproj
  </verify>
  <done>
All rejection and abort enums compile without warnings. Values match DICOM PS3.8 tables exactly.
  </done>
</task>

<task type="auto">
  <name>Task 3: DicomStatus struct and network exceptions</name>
  <files>
    src/SharpDicom/Network/StatusCategory.cs
    src/SharpDicom/Network/DicomStatus.cs
    src/SharpDicom/Network/Exceptions/DicomNetworkException.cs
    src/SharpDicom/Network/Exceptions/DicomAssociationException.cs
    src/SharpDicom/Network/Exceptions/DicomAbortException.cs
    tests/SharpDicom.Tests/Network/DicomStatusTests.cs
  </files>
  <action>
1. **StatusCategory.cs** - Enum for DIMSE status categories:
   - Success, Pending, Warning, Failure, Cancel

2. **DicomStatus.cs** - Readonly struct per PS3.7 Annex C:
   - `ushort Code` property
   - `StatusCategory Category` computed property using code ranges:
     - 0x0000 = Success
     - 0xFE00 = Cancel
     - 0xFF00-0xFF01 = Pending
     - 0xB000-0xBFFF = Warning
     - 0xA000-0xAFFF, 0xC000-0xCFFF = Failure
   - `bool IsSuccess`, `IsWarning`, `IsFailure`, `IsPending`, `IsCancel` computed properties
   - `string? ErrorComment` init-only property
   - IEquatable<DicomStatus> implementation
   - Well-known static instances: Success, Cancel, Pending, NoSuchSOPClass, ProcessingFailure
   - Override ToString() to return "0x{Code:X4} ({Category})"

3. **DicomNetworkException.cs** - Base network exception extending DicomException:
   - Standard constructors (message, message+inner)

4. **DicomAssociationException.cs** - Extending DicomNetworkException:
   - Properties: RejectResult?, RejectSource?, RejectReason?
   - Constructor accepting these values

5. **DicomAbortException.cs** - Extending DicomNetworkException:
   - Properties: AbortSource, AbortReason
   - Constructor accepting these values

6. **DicomStatusTests.cs** - Unit tests:
   - Test status categorization for each category
   - Test well-known instances
   - Test equality
   - Test IsSuccess, IsWarning, etc. properties
  </action>
  <verify>
dotnet test tests/SharpDicom.Tests/SharpDicom.Tests.csproj --filter "FullyQualifiedName~DicomStatusTests"
  </verify>
  <done>
DicomStatus correctly categorizes all status code ranges. Network exceptions properly extend hierarchy. All DicomStatus tests pass.
  </done>
</task>

</tasks>

<verification>
All verification commands must pass:

```bash
# Build the library
dotnet build src/SharpDicom/SharpDicom.csproj --configuration Release

# Run all tests
dotnet test tests/SharpDicom.Tests/SharpDicom.Tests.csproj

# Verify new types exist
grep -r "public enum PduType" src/SharpDicom/Network/
grep -r "public readonly struct DicomStatus" src/SharpDicom/Network/
grep -r "public class DicomNetworkException" src/SharpDicom/Network/
```
</verification>

<success_criteria>
- All 7 PDU types defined in PduType enum
- All item types defined for variable field parsing
- DicomStatus categorizes all status code ranges correctly
- Network exception hierarchy established (DicomNetworkException, DicomAssociationException, DicomAbortException)
- All tests pass (existing 2070 + new DicomStatus tests)
- No build warnings
</success_criteria>

<output>
After completion, create `.planning/phases/10-network-foundation/10-01-SUMMARY.md`
</output>
